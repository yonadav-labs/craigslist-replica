{% extends "base.html" %} 
{% load staticfiles %} 

{% block extra_css %}
<link rel='stylesheet' id='dropdown-menu-style-css' href='/static/css/my-ads.css' type='text/css' media='all' /> 
<link rel='stylesheet' id='dropdown-menu-style-css' href='/static/css/dropdown-menu-style.css?v=1' type='text/css' media='all' /> 

{% block own_css %}
<style type="text/css">
.content-right-content.my-ads .ads_list .my_add .actions .status {
    border: none !important;
    width: auto !important;
    margin-right: 0px !important;
}
</style>
{% endblock %}

{% endblock %} 

{% block page_content %}

<div id="page" class="site">
    <div class="site-inner">
        <div id="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="admin-content-menu-and-content-section clearfix">
                        <!-- Content Left Section -->
                        <div class="col-md-2 col-sm-12 md-media-full-widht no-padding admin-content-left-section">
                            <!-- Logo Section -->
                            <div class="logo-section clearfix">

                                <div class="navbar-brand-profile">
                                    <a href="/" class="custom-logo-link" rel="home" itemprop="url"><img width="240" height="67" src="/static/img/cropped-logo.png" class="custom-logo" alt="" itemprop="logo" /></a>
                                </div>
                            </div>
                            <!-- End Logo Section -->

                            <!-- Header -->

                            <header>
                                <div class="left-menu-bar">
                                    <div class="cd-dropdown-wrapper">
                                        <div class="menu-button-center">
                                            <a class="cd-dropdown-trigger" href="#0"><i class="fa fa-bars" aria-hidden="true"></i></a>
                                        </div>

                                        <nav class="cd-dropdown">
                                            <a href="#0" class="cd-close">Close</a>
                                            <div class="menu-profile-side-menu-container">
                                                <ul id="menu-profile-side-menu" class="cd-dropdown-content">
                                                    <li id="menu-item-42" class="home menu-item menu-item-type-custom menu-item-object-custom menu-item-42"><a href="/profile/" class="">Home</a></li>
                                                    {% if user.is_authenticated %}
                                                        <li id="menu-item-43" class="ads menu-item menu-item-type-custom menu-item-object-custom menu-item-43"><a href="/my-ads" class="">My Ads</a></li>
                                                        <li id="menu-item-44" class="account menu-item menu-item-type-custom menu-item-object-custom menu-item-44"><a href="#/my-account" class="">My Account</a></li>
                                                        <li id="menu-item-260" class="account menu-item menu-item-type-post_type menu-item-object-page menu-item-260"><a href="#/my-subscribe" class="">My Subscribe</a></li>
                                                        <li id="menu-item-45" class="favorites menu-item menu-item-type-custom menu-item-object-custom menu-item-45"><a href="#/my-favourites" class="">My Favorites</a></li>
                                                        <li id="menu-item-46" class="logout menu-item menu-item-type-custom menu-item-object-custom menu-item-46"><a href="/logout" class="">Log Out</a></li>
                                                    {% endif %}
                                                </ul>
                                            </div>
                                        </nav>
                                        <!-- .cd-dropdown -->
                                    </div>
                                </div>
                            </header>
                            <!-- End Header -->
                        </div>

                        <div class="col-md-10 col-sm-12 md-media-full-widht no-padding">
                            <!-- Content Right Header -->
                            <div class="col-sm-12 no-padding">
                                <!-- Header User Section -->
                                <div class="header-user-section clearfix">
                                {% if user.is_authenticated %}
                                    <div class="header-user-section-ico">
                                        <a href="#"><img src="/static/img/big_avatar.png" alt=""></a>
                                    </div>
                                    <div class="header-user-section-message-to-ico">
                                        <a href="#/my-messages">
                                            <i class="fa fa-envelope" aria-hidden="true"></i>
                                        </a>
                                    </div>
                                    <div class="header-user-section-welcome">
                                        Welcome, {{ user.username }}!
                                    </div>
                                {% endif %}
                                </div>
                                <!-- End Header User Section -->
                            </div>

                            {% block right_content %}
                            <!-- Content Right Content -->
                            <div class="col-sm-12">
                                <div class="content-right-content">
                                    <nav class="breadcrumb">
                                        <a class="breadcrumb-item" href="/profile/">worldwide<i class="fa fa-long-arrow-right" aria-hidden="true"></i></a>
                                        <!--<a class="breadcrumb-item" href="#"><i class="fa fa-long-arrow-right" aria-hidden="true"></i></a>-->
                                    </nav>
                                    <span id="world_link"><a href="/profile/">World</a></span>

                                    <!-- Content Full Width Map Img -->

                                    <div class="full-map-img">

                                        <!--  <div id="mapdiv"></div> -->

                                    </div>

                                    <div id="demo-wrapper">
                                        <div id="mapBox">
                                            <div id="up"></div>
                                            <div class="selector" style="display:none">
                                                <button id="btn-prev-map" class="prev-next"><i class="fa fa-angle-left"></i></button>
                                                <select id="mapDropdown" class="ui-widget combobox"></select>
                                                <button id="btn-next-map" class="prev-next"><i class="fa fa-angle-right"></i></button>
                                                <input type="hidden" id="cn_code" value="US">
                                            </div>
                                            <div id="container"></div>
                                        </div>
                                    </div>

                                    <!-- End Content Full Width Map Img -->

                                    <div class="1" id="nearest">
                                    </div>

                                    <!-- Content Full Select Country -->
                                    <h3 id="title_of_list">
                                        {% if request.GET.state_id or request.GET.mycusid %}
                                            Select Regions            
                                        {% else %}
                                            Select Country
                                        {% endif %}
                                    </h3>

                                    <div class="content-select-country clearfix">   
                                        {% autoescape off %}{{ rndr_str }}{% endautoescape %} 
                                    </div>

<!--                                     <div class="content-recent-ads ads_list">
                                        <h3>Recent Ads</h3>
                                    </div>
 -->

                                    <div class="btn-view-all-center">
                                        <a href="/view-all/" class="btn btn-default btn-view-all">
                                            View All
                                        </a>
                                    </div>

                                </div>
                                <div class="loader_content"></div>

                            </div>
                            <!-- End Content Right Content -->
                            {% endblock %}

                            <div class="modal fade" id="subscribe-myModal" role="dialog">
                                <div class="modal-dialog view-modal-dialog">

                                    <!-- Modal content-->
                                    <div class="modal-content comman-modal subscribe-modal">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                                            <h4 class="modal-title">Subscribe to Search</h4>
                                        </div>
                                        <div class="modal-body">
                                            <div class="modal-service">
                                                <span class="small-text">you are about to subscribe to following search</span>
                                                <p>finance + finance1</p>
                                            </div>
                                            <div class="modal-service">
                                                <span class="small-text">in the following region</span>
                                                <p>Worldwide</p>
                                            </div>
                                            <div class="modal-service">
                                                <span class="small-text">in the following category</span>
                                                <p>Finance</p>
                                            </div>
                                            <p class="subscribe-info">you would receive mails daily, around 6 am GMT</p>
                                            <div class="">
                                                <input class="btn btn-info msg-send-btn experience-send-btn" name="" value="Confirm" type="button">
                                                <button type="button" class="btn btn-default cancel-btn" data-dismiss="modal">cancel</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <!-- .md-media-full-widht -->

                    </div>
                    <!-- .admin-content-menu-and-content-section -->

                </div>
                <!-- .row -->

            </div>
            <!-- .container-fluid -->

        </div>
        <!-- .site-content -->

    </div>
    <!-- .site-inner -->

</div>
<!-- .site -->

{% endblock %} 

{% block extra_js %}

{% block load_highcharts_js %}
<script src="/static/js/highmaps.js"></script>
<script src="/static/js/index.js"></script>
<script src="/static/js/jquery.combobox.js"></script>
{% endblock %}

{% block own_js %}
<script>
    jQuery(function() {
        $("#world_link").hide();
        /**
         * This is a complicated demo of Highmaps, not intended to get you up to speed
         * quickly, but to show off some basic maps and features in one single place.
         * For the basic demo, check out http://www.highcharts.com/maps/demo/geojson instead.
         */

        // Base path to maps
        var baseMapPath = "https://code.highcharts.com/mapdata/",
            showDataLabels = false, // Switch for data labels enabled/disabled
            mapCount = 0,
            searchText,
            mapOptions = '';
        // Populate dropdown menus and turn into jQuery UI widgets
        $.each(Highcharts.mapDataIndex, function(mapGroup, maps) {
            if (mapGroup !== "version") {
                mapOptions += '<option class="option-header">' + mapGroup + '</option>';
                $.each(maps, function(desc, path) {
                    mapOptions += '<option value="' + path + '" sec_name="' + desc + '">' + desc + '</option>';
                    mapCount += 1;
                });
            }
        });
        searchText = 'Search ' + mapCount + ' maps';
        mapOptions = '<option value="custom/world.js">' + searchText + '</option>' + mapOptions;
        $("#mapDropdown").append(mapOptions).combobox();
        // Change map when item selected in dropdown
        $("#mapDropdown").change(function() {
            var $selectedItem = $("option:selected", this),
                mapDesc = $selectedItem.text(),
                mapKey = this.value.slice(0, -3),
                svgPath = baseMapPath + mapKey + '.svg',
                geojsonPath = baseMapPath + mapKey + '.geo.json',
                javascriptPath = baseMapPath + this.value,
                isHeader = $selectedItem.hasClass('option-header');
            // Dim or highlight search box
            if (mapDesc === searchText || isHeader) {
                $('.custom-combobox-input').removeClass('valid');
                location.hash = '';
            } else {
                $('.custom-combobox-input').addClass('valid');
                location.hash = mapKey;
            }
            if (isHeader) {
                return false;
            }
            // Show loading
            if (Highcharts.charts[0]) {
                Highcharts.charts[0].showLoading('<i class="fa fa-spinner fa-spin fa-2x"></i>');
            }

            // When the map is loaded or ready from cache...
            function mapReady() {
                var mapGeoJSON = Highcharts.maps[mapKey],
                    data = [],
                    parent,
                    match;
               
                // Generate non-random data for the map
                $.each(mapGeoJSON.features, function(index, feature) {
                    data.push({
                        key: feature.properties['hc-key'],
                        value: index
                    });
                });
                // Show arrows the first time a real map is shown

                if (mapDesc !== searchText) {
                    $('.selector .prev-next').show();
                    $('#sideBox').show();
                }

                // Is there a layer above this?
                match = mapKey.match(/^(countries\/[a-z]{2}\/[a-z]{2})-[a-z0-9]+-all$/);
                if (/^countries\/[a-z]{2}\/[a-z]{2}-all$/.test(mapKey)) { // country
                    parent = {
                        desc: 'World',
                        key: 'custom/world'
                    };

                } else if (match) { // admin1
                    parent = {
                        desc: $('option[value="' + match[1] + '-all.js"]').text(),
                        key: match[1] + '-all'
                    };

                }
                $('#up').html('');
                if (parent) {
                    $('#up').append(
                        $('<a><i class="fa fa-angle-up"></i> ' + parent.desc + '</a>')
                        .attr({
                            title: parent.key
                        })
                        .click(function() {
                            $('#mapDropdown').val(parent.key + '.js').change();
                            $('.breadcrumb').html('<a class="breadcrumb-item" href="/profile/">worldwide<i class="fa fa-long-arrow-right" aria-hidden="true"></i></a>');
                        })
                    );
                }
                var cn_code;
                // Instantiate chart
                var map = $("#container").highcharts('Map', {
                    title: {
                        text: null
                    },
                    mapNavigation: {
                        enabled: true,

                    },
                    colorAxis: {
                        min: 0,
                        stops: [
                            [0, '#EFEFFF'],
                            [0.5, Highcharts.getOptions().colors[0]],
                            [1, Highcharts.Color(Highcharts.getOptions().colors[0]).brighten(-0.5).get()]
                        ]
                    },
                    legend: {
                        layout: 'vertical',
                        align: 'left',
                        verticalAlign: 'bottom'
                    },

                    series: [{
                        data: data,
                        mapData: mapGeoJSON,
                        joinBy: ['hc-key', 'key'],
                        name: 'Random data',
                        states: {
                            hover: {
                                color: Highcharts.getOptions().colors[2]
                            }
                        },
                        dataLabels: {
                            //enabled: showDataLabels,
                            //format: '{point.name}',
                            formatter: function() {
                                return mapKey === 'custom/world' ?
                                    (this.point.properties && this.point.properties['hc-a2']) :
                                    this.point.name;
                            }
                        },
                        point: {
                            events: {
                                // On click, look for a detailed map
                                click: function() {

                                    var key = this.key;
                                    var sec_name = '';
                                    $('#mapDropdown option').each(function() {
                                        if (this.value === 'countries/' + key.substr(0, 2) + '/' + key + '-all.js') {
                                            $('#mapDropdown').val(this.value).change();
                                            var iscountry = this.value;
                                            sec_name = this.text;
                                            //console.log("sec_name "+sec_name);
                                            //console.log(key+' - key');
                                            $("#cn_code").val(key);
                                        }
                                    });
                                    var state_id, shu = 'state';
                                    var country_code = $("#cn_code").val(); //country code
                                    state_id = this.name; // state name

                                    if (country_code != "") {
                                        state_id = country_code;
                                        shu = 'country';
                                    } 

                                    $("#cn_code").val("");
                                    //fetch(state_id,sec_name);
                                    breadcrumb(state_id);
                                    fetch(state_id, sec_name);

                                    if (state_id.substring(2,3) == '-' && shu == 'country') {
                                        state_id = this.name;
                                        shu = 'state';
                                    }

                                    home_recent_ads(state_id, shu);
                                }
                            }
                        }
                    }, {
                        type: 'mapline',
                        name: "Separators",
                        data: Highcharts.geojson(mapGeoJSON, 'mapline'),
                        nullColor: 'gray',
                        showInLegend: false,
                        enableMouseTracking: false
                    }]
                });
                showDataLabels = $("#chkDataLabels").attr('checked');
            }
            // Check whether the map is already loaded, else load it and
            // then show it async
            if (Highcharts.maps[mapKey]) {
                mapReady();
            } else {
                $.getScript(javascriptPath, mapReady);
            }
        });

        // Trigger change event to load map on startup
        if (location.hash) {
            $('#mapDropdown').val(location.hash.substr(1) + '.js');

        } else { // for IE9
            $($('#mapDropdown option')[0]).attr('selected', 'selected');

        }
        $('#mapDropdown').change();

        jQuery("body").on('click', '.regions_li', function() {
            fetch(jQuery(this).data('pid'));
            breadcrumb(jQuery(this).data('pid'));
            home_recent_ads(jQuery(this).data('pid'), 'state');
        });
    });

    if (location.hash != "") {
        setTimeout(function() {
            var link = location.hash;
            var arr = link.split('/');
            var country_code = arr[1].toUpperCase();
            var country = country_code;

            var vall = 'countries/' + country.toLowerCase() + '/' + country.toLowerCase() + '-all.js';
            $('#mapDropdown').val(vall).change();
            var iscountry = vall;
            $("#cn_code").val(country.toLowerCase());
            var state_id, shu = 'state';
            var country_code = $("#cn_code").val(); //country code
            state_id = jQuery(this).text(); // state name

            if (country_code != "") {
                state_id = country_code;
                shu = 'country';
            } 
            $("#cn_code").val("");
            console.log("stateid " + state_id);
            fetch(state_id);
            breadcrumb(state_id);
            home_recent_ads(state_id, shu);

        }, 500);
    }

    function breadcrumb(uid, shu) {
        return;
        //console.log('this is id: '+uid);
        if (typeof(shu) === 'undefined') shu = '';
        if (shu == 'cities') {
            var data = {
                name: uid,
                shu: shu,
                'action': 'breadcrumb_action',
            };
            $.post('/wp-admin/admin-ajax.php', data, function(response) {
                var js;
                bc = JSON.parse(response);
                console.log(bc);
                var no = bc[0].no;
                var type = bc[0].type;
                var bread_var = $('.breadcrumb').html();
                if (type == "cities") {
                    if (no > 0) {
                        var part = '<a class="breadcrumb-item" href="#">' + bc[0].name + '<i class="fa fa-long-arrow-right" aria-hidden="true"></i></a>';
                        $(".breadcrumb").append('<a class="breadcrumb-item" href="#">' + bc[0].name + '</a>');
                    } else {

                    }

                }
            });
        } else {

            var data = {
                name: uid,
                'action': 'breadcrumb_action',
            };
            $.post('/wp-admin/admin-ajax.php', data, function(response) {
                var js;
                bc = JSON.parse(response);
                console.log(bc);
                var no = bc[0].no;
                var type = bc[0].type;
                var bread_var = $('.breadcrumb').html();
                if (type == "country") {
                    if (no > 0) {
                        var part = '<a class="breadcrumb-item" href="#">' + bc[0].name + '<i class="fa fa-long-arrow-right" aria-hidden="true"></i></a>';
                        $(".breadcrumb").append('<a class="breadcrumb-item" href="#">' + bc[0].name + '<i class="fa fa-long-arrow-right" aria-hidden="true"></i></a>');
                    }
                }
                if (type == "states") {
                    if (no > 0) {
                        var part = '<a class="breadcrumb-item" href="#">' + bc[0].name + '<i class="fa fa-long-arrow-right" aria-hidden="true"></i></a>';
                        $(".breadcrumb").append('<a class="breadcrumb-item" href="#">' + bc[0].name + '<i class="fa fa-long-arrow-right" aria-hidden="true"></i></a>');
                    }
                }
            });
        }
    }

    function fetch(state_id, sec_name) {
        //alert(state_id);
        var data = {
            'state_id': state_id,
            'sec_name': sec_name
        };

        $.get('/ajax_region', data, function(response) {
            var js = response;
            var no = js[0].no;
            var type = js[0].type;
            if (type == "regions") {
                $("#title_of_list").html("Select Regions");
                if (no == 0) {
                    $(".content-select-country").html("");
                    $(".content-select-country").html("<ul class='list'>No regions found</ul>");
                } else {
                    $(".content-select-country").html("");
                    $(".content-select-country").html("<ul class='list'></ul>");
                    //var html = $(".content-select-country").html("<ul class="+key+">");
                    console.log(js.length);
                    var k;
                    var html = "";
                    var i;
                    $.each(js, function(key, value) {
                        html += "<li class='regions_li' data-type='" + type + "' data-pid=\"" + value.name + "\" ><a href='#'>" + value.name + "</a></li>";
                    });
                    $(html).appendTo('ul.list');
                }
            }
            if (type == "cities") {
                $("#title_of_list").html("Select Cities");
                $("#demo-wrapper").hide();
                $("#world_link").show();
                if (no == 0) {
                    $(".content-select-country").html("");
                    $(".content-select-country").html("<ul class='list'>No city found</ul>");
                } else {
                    $(".content-select-country").html("");
                    $(".content-select-country").html("<ul class='list'></ul>");
                    //var html = $(".content-select-country").html("<ul class="+key+">");
                    console.log(js.length);
                    var k;
                    var html = "";
                    var i;
                    $.each(js, function(key, value) {
                        html += "<li ><a class='get_category_by_location' data-id='" + value.id + "' href='#'>" + value.name + "</a></li>";
                    });
                    $(html).appendTo('ul.list');
                }
            }
        });
    }

    function home_recent_ads(region_id, shu) {
        // jQuery.ajax({
        //     type: 'get',
        //     url: '/get_ads',
        //     data: {
        //         'region_id': region_id,
        //         'kind': shu
        //     },
        //     success: function(data) {
        //         if (data != '') {
        //             data = '<h3>Recent Ads</h3>' + data;
        //             $('.content-recent-ads').html(data);
        //             jQuery('.loader_content').removeClass('active');
        //         }
        //     }
        // });
    }

    $("body").on('click', '.get_category_by_location', function() {
        var city_id = $(this).data('id');
        breadcrumb(city_id, 'cities');
        home_recent_ads(city_id, 'city');

        jQuery.ajax({
            type: 'get',
            url: '/get_category_by_location_id',
            data: {
                city: city_id
            },
            success: function(data) {
                $('#title_of_list').html('Select Category');
                $('.content-select-country').html(data);
            }
        });
    });
    
</script>
{% endblock %}

<script type="text/javascript">
    //open/close mega-navigation for mobile
    $('.cd-dropdown-trigger').on('click', function(event) {
        event.preventDefault();
        toggleNav();
    });

    //close meganavigation
    $('.cd-dropdown .cd-close').on('click', function(event) {
        event.preventDefault();
        toggleNav();
    });

    function toggleNav() {
        var navIsVisible = (!$('.cd-dropdown').hasClass('dropdown-is-active')) ? true : false;
        $('.cd-dropdown').toggleClass('dropdown-is-active', navIsVisible);
        $('.cd-dropdown-trigger').toggleClass('dropdown-is-active', navIsVisible);
        if (!navIsVisible) {
            $('.cd-dropdown').one('webkitTransitionEnd otransitionend oTransitionEnd msTransitionEnd transitionend', function() {
                $('.has-children ul').addClass('is-hidden');
                $('.move-out').removeClass('move-out');
                $('.is-active').removeClass('is-active');
            });
        }
    }
</script>
{% endblock %}