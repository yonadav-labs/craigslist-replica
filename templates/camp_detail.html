{% extends "profile.html" %} 
{% load staticfiles %} 
{% load humanize %} 
{% load extra %} 

{% block right_content %}
    <!-- Content Right Content -->

    <div class="col-sm-offset-1 col-sm-10">
        <div class="content-right-content ad-view" style="padding: 15px 0;">
            <div class="main-product campaign-detail">
                <div class="col-md-7 no-padding video-wrap">
                    <div style="display:none;margin:0 auto;" class="html5gallery" data-skin="light" data-slideshadow="false" data-resizemode="fill">                
                        {% for vid in post|get_vids %}
                            <a href="http://www.youtube.com/embed/{{ vid }}"><img src="http://img.youtube.com/vi/{{ vid }}/0.jpg" alt="Youtube Video"></a>
                        {% endfor %}
                    </div>                    
                </div>
                <div class="col-md-5">
                    <div class="ctitle">{{ post.title }}</div>
                    <div class="tagline">{{ post.tagline }}</div>
                    <div class="col-md-12 no-padding" style="margin-top: 18px;">
                        <div class="star-profile">
                            <a href="#">
                                <img src="/static/media/avatar/{{ post.owner.avatar }}" width="80" height="80">
                            </a>
                            <div class="star-profile-name" style="display: inline-block;">
                                <div><b>{{ post.owner.first_name }} {{ post.owner.last_name }}</b></div>
                                <div class="m-t-10">{{ post.owner.address }}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="product-location-info">
                        <div class="product-location-info-left">
                            <span>Category</span>
                            <h6>{{ post.category.name }}</h6>
                        </div>
                    </div>
                    <div class="budget">
                        <span class="raised">${{ post.raised|intcomma }}</span> USD raised by 345 bakers
                    </div>
                    <div id="myProgress">
                        <div id="myBar" style="width: {{ post|raised_percent:1 }}%;"></div>
                    </div>            
                    <div class="duration">
                        <span class="percent"><b>{{ post|raised_percent }}%</b> of ${{ post.budget|intcomma }}</span>
                        <span class="left-days"> <i class="fa fa-clock-o" aria-hidden="true"></i> {{ post|ramained_days }} days left </span>
                    </div>
                    <div><button class="btn-donate">BACK IT</button></div>
                </div>
                <div class="col-md-7">
                    <span class="cheader">OVERVIEW</span>
                    <hr>
                    <div class="row overview">
                        <div class="col-md-5">
                            <img class="img-responsive" src="/static/media/{{ post.over_image }}">
                        </div>
                        <div class="col-md-7">
                            {{ post.overview }}
                        </div>
                    </div>
                    <div class="cheader ext">STORY</div>
                    <hr>
                    <div class="product-text">
                        {% autoescape off %}{{ post.content }}{% endautoescape %}
                    </div>
                </div>
                <div class="col-md-5">
                <div class="col-sm-offset-1 col-sm-10">
                <span class="cheader">PERKS</span>
                <hr>
                {% for perk in perks %}
                    <div class="perk-card" data-price="{{ perk.price }}00" data-title="{{ perk.title }}">
                        {% if perk.image %}
                            <img src="/static/media/{{ perk.image }}" class="img-responsive">
                        {% endif %}
                        <div class="price"><span>${{ perk.price|intcomma }}</span> USD</div>
                        <div class="ctitle">{{ perk.title }}</div>
                        <div class="overview">{{ perk.description }}</div>
                        <div class="num_claimed">
                            {{ perk.num_claimed }} {% if perk.num_avail != 1000000 %}out of {{ perk.num_avail }}{% endif %} claimed
                        </div>
                        <div class="btn-perk">GET THIS PERK</div>
                    </div>
                {% endfor %}
                </div>
                </div>
            </div>            
            
        </div>
    </div>

<!-- Modal -->
<div id="perk-modal" class="perk-modal modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
    <form action="" method="post">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Early Bird Backers- Board Only</h4>
      </div>
      <div class="modal-body">
        <div class="modal-price">Price: <b>$399</b> USD</div>
        <div class="form-group">
        <label>Contact Information</label>
        <small>Please provide email, phone number, address ...</small>
        <textarea class="form-control" rows=4>
            {{ user.email }} 
            {{ user.phone }}
        </textarea>
        </div>
        <input type="hidden" name="stripeToken" id="stripe_token">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn" id="btn-pay">CONTINUE</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">CLOSE</button>
      </div>
    </form>
    </div>

  </div>
</div>    
{% endblock %}

{% block load_highcharts_js %}
{% endblock %}

{% block own_js %}
<script type="text/javascript">
    var w = $('.video-wrap').width();
    $('.html5gallery').data('width', w-24);
    $('.html5gallery').data('height', Math.floor(w*0.74));
    console.log(w);
</script>
<script type="text/javascript" src="/static/html5gallery/html5gallery.js"></script>
<script src="https://checkout.stripe.com/checkout.js"></script>

<script type="text/javascript">
    var price = 1000; 

    var handler = StripeCheckout.configure({
        key: '{{ skey }}',
        locale: 'auto',
        token: function(token) {
            $('#stripe_token').val(token.id);
            $("input.update-btn").removeAttr('disabled');
        }
    });

    $('#btn-pay').on('click', function(e) {
        handler.open({
            name: "Globalboard",
            description: "Claim Perk",
            currency: "usd",
            amount: price
        });
        e.preventDefault();
    });

    // Close Checkout on page navigation:
    $(window).on('popstate', function() {
        handler.close();
    });

    $('.btn-perk').click(function() {
        $('#perk-modal').modal();
    });
</script>
{% endblock %}