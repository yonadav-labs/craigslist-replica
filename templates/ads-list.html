{% extends "profile.html" %} 
{% load staticfiles %} 


{% block right_content %}
    <!-- Content Right Content -->

    <div class="col-sm-12 full-h">

        <div class="content-right-content my-ads">
            <nav class="breadcrumb">                                        
            {% autoescape off %}{{ breadcrumb }}{% endautoescape %}
            </nav>

            <h2>
                Ads List 
                {% if category %}
                    <small> (
                    {% if category.parent %}
                        {{ category.parent.name }} / 
                    {% endif %}
                    {{ category.name }}
                    )</small>
                {% endif %}
            </h2>            
            <div class="col-md-8 ads_search search">
                <input type="text" class="search-input ads_search_input" name="ads_search" placeholder="Search for ads name...">
            </div>
            <div class="col-md-2 ads_search">
                <input type="submit" id="search_ads" class="btn btn-info" value="Search">
            </div>
            <div class="col-md-2 ads_search">
                <input type="submit" id="search_ads" class="btn btn-info subscribe" value="Subscribe">
            </div>
            <div class="col-md-12 m-t-15">
                <a class="" href="javascript: void();" onclick="$('.filters').toggle();"><i class="fa fa-filter"></i> More filters</a>
            </div>
            <div class="col-md-12 m-t-15 filters well">
                <div class="col-md-2">
                    <div class="checkbox">
                        <label><input type="checkbox" id="ck_search_title" style="margin-top: 0;" value="">Search titles only</label>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="checkbox">
                        <label><input type="checkbox" id="ck_has_image" style="margin-top: 0;" value="">Has image</label>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="checkbox">
                        <label><input type="checkbox" id="ck_posted_today" style="margin-top: 0;" value="">Posted today</label>
                    </div>
                </div>
                <div class="col-md-5 form-inline">
                    <div class="form-group">
                        <label for="email">Price: </label>
                        <input type="number" id="ft_min_price" class="form-control" placeholder="Min price">
                    </div>
                    <div class="form-group">
                        <input type="number" id="ft_max_price" class="form-control" placeholder="Max price">
                    </div>
                </div>
            </div>
            <div class="ads_list" id="ads_list">
            {% include '_post_list.html' %}            
            </div>
        </div>

    </div>
{% endblock %}

{% block load_highcharts_js %}
{% endblock %}

{% block own_js %}
<script>
    jQuery(document).ready(function(){                
        jQuery('#search_ads').click(function() {
            search_ads();
        });

        jQuery('.ads_search_input').keypress(function(e) {
            var key = e.which;
            if (key == 13) {
                search_ads();
            }
        });

        $('#ck_search_title').click(function() {
            search_ads();
        });

        $('#ck_has_image').click(function() {
            search_ads();
        });

        $('#ck_posted_today').click(function() {
            search_ads();
        });

        function search_ads() {
            var search_val = jQuery('.ads_search_input').val();
            console.log($('#ck_search_title').prop("checked"));

            jQuery.ajax({
                type: 'post',
                url: '/search_ads',
                data: {
                    keyword: search_val,
                    others: true,
                    ck_search_title: $('#ck_search_title').prop("checked"),
                    ck_has_image: $('#ck_has_image').prop("checked"),
                    ck_posted_today: $('#ck_posted_today').prop("checked"),
                    min_price: $('#ft_min_price').val(),
                    max_price: $('#ft_max_price').val()
                },
                success: function (data) {
                    jQuery('#ads_list').html(data);
                }
            });                     
        }
    });  

    $("body").on('click', 'a.breadcrumb-item', function() {
        location.href = '/profile#' + $(this).data('mapname');
    });

    $('.subscribe').click(function() {
        var keyword = jQuery('.ads_search_input').val();

        jQuery.ajax({
            type: 'post',
            url: '/create-subscribe',
            data: {
                keyword: keyword,
            },
            success: function (data) {
                alert('Subscribed successfully!');
            }
        });                             
    });
</script>

{% endblock %}